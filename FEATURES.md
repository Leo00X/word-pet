# WordParasite 功能清单

> **版本**: v2.0  
> **更新日期**: 2025-12-06  
> **完成度**: 约 80%

---

## 📚 目录

- [核心功能](#核心功能)
- [AI 系统](#ai-系统)
- [成长与互动](#成长与互动)
- [UI 与交互](#ui-与交互)
- [开发工具](#开发工具)
- [功能路线图](#功能路线图)

---

## ✅ 核心功能

### 1. 桌面悬浮窗系统 ⭐⭐⭐⭐⭐

**状态**: ✅ 已完成并优化

**功能描述**:
- 全局悬浮窗显示（覆盖所有应用）
- 自由拖拽和边缘吸附
- WebView 渲染宠物动画
- 实时状态同步（心情、等级、皮肤）

**技术实现**:
- UTS 插件: `android-floatwindow`
- 本地 HTML: `static/pet.html`
- Composable: `useFloatWindow.js`

**使用方式**:
```
主页 → 状态监控 Tab → 召唤寄生兽按钮
```

---

### 2. 应用监控系统 ⭐⭐⭐⭐⭐

**状态**: ✅ 已完成

**功能描述**:
- 毫秒级检测前台应用
- 自动识别学习/娱乐应用
- 实时统计使用时长
- 黑白名单管理

**技术实现**:
- Native.js: `UsageStatsManager`
- Composable: `useMonitor.js`
- 工具: `appTool.js` (应用扫描)

**使用方式**:
```
主页 → 状态监控 Tab → 开启全域监控按钮
系统设置 → 投喂规则 (白名单)
系统设置 → 禁忌物品 (黑名单)
```

**配置选项**:
- ⚡ 扫描频率: 3s (极速) / 10s (平衡) / 60s (省电)

---

### 3. 权限管理系统 ⭐⭐⭐⭐

**状态**: ✅ 已完成

**功能描述**:
- 悬浮窗权限检测与申请
- 应用使用统计权限检测
- 实时权限状态监控

**技术实现**:
- Composable: `usePermissions.js`
- Native API: `Settings.canDrawOverlays()`

**权限指示灯**:
- 🟢 正常: 权限已授予
- 🔴 断开: 权限未授予

---

## 🤖 AI 系统

### 1. 多模型支持 ⭐⭐⭐⭐⭐

**状态**: ✅ 已完成

**支持模型**:

| 模型 | 提供商 | 特点 | 成本 |
|------|--------|------|------|
| **DeepSeek V3.2** | DeepSeek | 高性价比 | 极低 |
| **Gemini 2.5 Flash** | Google | 极快响应 | 低 |
| **Gemini 2.5 Pro** | Google | 深度推理 | 中等 |
| **自定义模型** | 任意 | OpenAI 兼容 | 自定义 |

**技术实现**:
- 适配器模式: `aiAdapters.js`
- 统一接口: `aiService.js`
- 配置管理: `useAIConfig.js`

**使用方式**:
```
主页 → 系统设置 Tab → 🤖 AI 模型选择
点击模型卡片 → 配置密钥 → 测试连接 → 保存
```

---

### 2. 对话聊天系统 ⭐⭐⭐⭐⭐

**状态**: ✅ 已完成并优化

**功能描述**:
- App 内独立聊天 Tab
- 多轮对话与上下文记忆
- 快捷回复按钮（4个预设）
- 消息历史分页加载
- Markdown 渲染支持

**技术实现**:
- Composable: `useChat.js`
- UI 组件: `ChatPanel.vue`, `ChatBubble.vue`
- 上下文管理: 最近 10 轮对话

**快捷回复**:
- 📚 "今天学了多久？"
- 📊 "查看我的数据"
- ❓ "你是谁？"
- 💪 "鼓励我一下"

**优化特性**:
- 相对时间显示（刚刚/5分钟前/昨天）
- 分页加载（默认显示 3 条，点击加载更多）
- 消息去重和顺序修复

---

### 3. AI 降级策略 ⭐⭐⭐⭐

**状态**: ✅ 已完成 (Phase 3)

**4 级降级方案**:

| 级别 | 模式 | 触发条件 | 超时 |
|------|------|---------|------|
| Level 0 | 完整AI | 默认 | 10s |
| Level 1 | 压缩AI | Level 0 超时 | 5s |
| Level 2 | 本地模板 | 网络错误 | - |
| Level 3 | 静态响应 | 彻底失败 | - |

**自动恢复**: 5 分钟无错误后自动升回高级别

**技术实现**:
- Composable: `useAIFallback.js`
- 控制器: `useAIController.js`

---

### 4. 记忆系统 ⭐⭐⭐⭐

**状态**: ✅ 已完成

**功能描述**:
- 对话历史记录
- 事实提取（用户名、偏好）
- 重要性评分
- 上下文摘要生成

**技术实现**:
- Composable: `useMemory.js`
- 存储: 最近 50 条重要对话

**提取信息**:
- 👤 用户名
- 🐾 宠物名
- ❤️ 喜好应用
- 📅 重要日期

---

## 🎮 成长与互动

### 1. 宠物成长系统 ⭐⭐⭐⭐⭐

**状态**: ✅ 已完成并集成

**核心属性**:

| 属性 | 范围 | 说明 |
|------|------|------|
| **等级 (Level)** | 1-99 | 通过学习获得经验升级 |
| **经验 (XP)** | 0-∞ | 学习时长累积 |
| **心情 (Mood)** | 0-100 | 学习增加，摸鱼减少 |
| **饥饿度 (Hunger)** | 0-100 | 随时间自然衰减 |
| **亲密度 (Bond)** | 0-100 | 互动增加 |
| **金币 (Coins)** | 0-∞ | 学习奖励，购买皮肤 |

**技术实现**:
- Composable: `useGrowth.js`
- 公式: `growthFormula.js`
- 形态: `petForms.js`

**升级公式**:
```
所需经验 = 等级 × 100
```

---

### 2. 学习奖励与摸鱼惩罚 ⭐⭐⭐⭐⭐

**状态**: ✅ 已完成

**学习奖励表**:

| 时长 | 经验 | 金币 | 心情 |
|------|------|------|------|
| 5 分钟 | +10 | +5 | +5 |
| 15 分钟 | +30 | +15 | +10 |
| 30 分钟 | +60 | +30 | +15 |
| 60 分钟 | +150 | +100 | +20 |

**摸鱼惩罚表**:

| 时长 | 心情 | 金币 | 饥饿度 |
|------|------|------|--------|
| 10 分钟 | -10 | 0 | 0 |
| 30 分钟 | -20 | 0 | -10 |
| 60 分钟 | -30 | -20 | -20 |
| 180 分钟 | -50 | -50 | -50 |

---

### 3. 皮肤系统 ⭐⭐⭐⭐⭐

**状态**: ✅ 已完成 (2025-12-06)

**功能描述**:
- 内置皮肤 (2个)
- 皮肤商城购买
- 解锁条件判定
- 悬浮窗同步切换

**内置皮肤**:
1. **经典幽灵** - 默认，免费
2. **像素田园犬** - 解锁条件: 等级 10

**解锁类型**:
- 等级解锁 (`level >= X`)
- 金币购买 (`coins >= X`)
- 成就解锁 (`achievement_id`)

**技术实现**:
- Composable: `useSkins.js` (509 行)
- UI: `SkinSelector.vue`, `SkinMarket.vue`
- 存储: `current_skin`, `purchased_skins`

**使用方式**:
```
主页 → 系统设置 Tab → 🎨 皮肤管理
或 系统设置 Tab → 🛒 皮肤商城
```

---

### 4. 成就系统 ⭐⭐⭐⭐

**状态**: ✅ 已完成

**成就清单** (13个):

| 类别 | 成就 | 解锁条件 |
|------|------|---------|
| **学习类** | 初学者 | 学习 1 小时 |
| | 勤奋者 | 学习 10 小时 |
| | 学霸 | 学习 100 小时 |
| **等级类** | 新手训练师 | 等级 10 |
| | 高级训练师 | 等级 50 |
| **金币类** | 小富翁 | 拥有 1000 金币 |
| **聊天类** | 话痨 | 发送 100 条消息 |
| **互动类** | 亲密伙伴 | 亲密度 100 |

**技术实现**:
- Composable: `useAchievements.js`
- 配置: `ACHIEVEMENTS` 常量
- 自动检查: 等级/金币/时长变化时触发

---

### 5. 悬浮窗智能互动系统 ⭐⭐⭐⭐⭐

**状态**: ✅ Phase 1-3 已完成 (2025-12-06)

**子系统**:

#### 5.1 行为树状态管理

**5 种根状态**:
- `IDLE` - 待机
- `INTERACTION` - 互动中
- `WORKING` - 工作中
- `ANGRY` - 愤怒
- `SLEEPING` - 睡眠

**12 种子状态**:
- IDLE: normal, sleepy, anxious, bored, excited, hungry
- SLEEPING: light_sleep, deep_sleep, dreaming
- ANGRY: warning_l1, warning_l2, warning_l3

**技术实现**:
- Composable: `useBehaviorTree.js` (287 行)

---

#### 5.2 手势识别引擎

**支持手势**:

| 手势 | 触发条件 | 宠物反应 |
|------|---------|---------|
| **TAP** | 单次点击 | 随机打招呼 |
| **DOUBLE_TAP** | 快速双击 | 打开主菜单 |
| **LONG_PRESS** | 按住 1 秒+ | 撒娇反应 |
| **SWIPE** | 快速滑动 | 躲闪 |
| **THROW** | 大力甩动 | 抗议 |

**技术实现**:
- Composable: `useGestureRecognizer.js` (197 行)
- 防抖机制: 避免误触

---

#### 5.3 睡眠/唤醒系统

**自动睡眠条件**:
- 🌙 深夜时段 (23:00 - 06:00)
- ⏰ 长时间无互动 (超过 30 分钟)

**睡眠效果**:
- 每 5 分钟做一个随机梦
- 每分钟恢复 1 点心情（最多 30 点）

**唤醒条件**:
- ☀️ 早晨时段 + 睡眠超过 1 小时
- 😴 睡眠超过 8 小时（强制唤醒）
- 👆 用户主动触摸

**技术实现**:
- Composable: `useSleepWake.js` (248 行)

---

#### 5.4 互动链编排

**互动链类型**:
- `GREETING` - 问候链
- `FEED` - 喂食链
- `PLAY` - 玩耍链
- `SCOLD` - 责骂链（摸鱼时）

**技术实现**:
- Composable: `useInteractionChain.js` (204 行)

---

#### 5.5 状态持续时间追踪

**统计数据**:
- 今日待机时长
- 今日互动次数
- 今日愤怒时长
- 今日睡眠时长

**技术实现**:
- Composable: `useStateDuration.js` (204 行)
- 每日自动重置

---

#### 5.6 随机 AI 互动 🆕

**状态**: ✅ 已完成 (2025-12-07)

**功能描述**:
- 宠物主动发起随机对话
- 12 种话题类型（无聊、好奇、关心、傲娇等）
- 智能冷却机制避免打扰

**触发条件**:

| 条件 | 参数 | 说明 |
|------|------|------|
| 空闲触发 | 5分钟无互动 | 宠物主动搭讪 |
| 随机触发 | 5% 概率/分钟 | 日常吐槽 |
| 全局冷却 | 2分钟 | 避免频繁打扰 |

**技术实现**:
- Composable: `useRandomChat.js` (270 行)
- 本地兜底: AI 失败时使用预设文案

---

## 🎨 UI 与交互

### 1. 聊天系统 UI ⭐⭐⭐⭐⭐

**状态**: ✅ 已优化 (2025-12-05)

**特性**:
- ✨ Markdown 渲染
- ✨ 光晕头像
- ✨ 渐变气泡
- ✨ 相对时间显示
- ✨ 分页加载

**组件**:
- `ChatPanel.vue` - 聊天面板
- `ChatBubble.vue` - 消息气泡

---

### 2. 成长日志 ⭐⭐⭐⭐

**状态**: ✅ 已完成

**功能描述**:
- 实时显示最近 3 条行为记录
- 完整历史记录页面
- 彩色数字显示（+绿色/-红色）

**记录类型**:
- 投喂成功 / 误食毒药
- 心情变化
- 经验获得
- 升级提示

**使用方式**:
```
主页 → 状态监控 Tab → 成长日记区域
点击 "查看全部档案" → 历史记录页
```

---

### 3. 伪终端日志 ⭐⭐⭐⭐

**状态**: ✅ 已完成

**功能描述**:
- 黑客风格终端窗口
- 实时日志输出
- 自动滚动到底部

**日志类型**:
- 系统事件
- 应用监控
- AI 请求
- 错误信息

**使用方式**:
```
主页 → 系统设置 Tab → 🖥️ 监控终端
```

**技术实现**:
- Composable: `useTerminal.js`
- UI: `TerminalModal.vue`

---

### 4. 状态栏与面板 ⭐⭐⭐⭐

**状态**: ✅ 已完成

**组件清单**:
- `StatusBar.vue` - 顶部状态栏（等级/金币）
- `StatusPanel.vue` - 监控数据面板
- `ConfigPanel.vue` - 系统设置面板
- `PetScreen.vue` - 宠物主屏幕

---

## 🛠️ 开发工具

### 1. 调试日志系统 ⭐⭐⭐⭐

**状态**: ✅ 已完成

**功能描述**:
- 分类日志输出
- 颜色区分（控制台）
- 开关控制

**日志函数**:
```javascript
import { 
  logUserAction,  // 用户操作
  logAI,          // AI 相关
  logMonitor,     // 监控相关
  logError,       // 错误日志
  logSuccess      // 成功提示
} from '@/utils/debugLog.js';
```

**关闭日志**:
编辑 `utils/debugLog.js`:
```javascript
const DEBUG_ENABLED = false;
```

---

### 2. 数据备份/恢复 ⭐⭐⭐

**状态**: ✅ 已完成

**功能描述**:
- 导出所有用户数据为 JSON
- 从 JSON 恢复数据
- 云端同步（规划中）

**技术实现**:
- Composable: `useCloudSync.js`
- UI: `BackpackPanel.vue`

---

### 3. 开发者测试功能 ⭐⭐⭐⭐

**状态**: ✅ 已完成 (2025-12-06)

**功能描述**:
- 快速升级宠物（一键+10级）
- 快速增加金币（+1000）
- 清空全部数据

**位置**: `ConfigPanel.vue` 仅开发环境显示

---

### 4. 文档体系与开发流程 ⭐⭐⭐⭐⭐

**状态**: ✅ 已完成 (2025-12-06)

**功能描述**:
- 完善的文档分类体系（guides/maintenance/archive）
- 8 个标准化开发 workflows
- AI 协作规则优化
- 文档职责明确分工

**文档结构**:
```
docs/
├── guides/              # 用户指南
├── maintenance/         # 维护文档（BUG/UPDATES/防范指南）
└── archive/             # 历史文档
```

**Workflows 清单**:
1. `1-guide-quick-start.md` - 快速启动
2. `1-guide-dev-with-ai.md` - AI 协作指南
3. `2-dev-add-feature.md` - 新增功能流程
4. `2-dev-fix-bug.md` - Bug 修复流程
5. `2-dev-debug-device.md` - 真机调试指南
6. `3-qa-code-review.md` - 代码审查清单
7. `4-docs-update.md` - 文档更新流程
8. `5-git-commit.md` - Git 提交规范

**优化内容**:
- Bug 防范指南从 756 行精简到 249 行（倒金字塔结构）
- UPDATES.md 从 410 行精简到 219 行（职责分离）
- 创建通用项目基础搭建指南

**技术亮点**:
- 倒金字塔原则（重要信息前置）
- 文档职责清晰分工
- AI 友好设计（前 50 行包含核心内容）

---

## 🚧 功能路线图

### 待开发功能

#### High Priority (P0)

- [ ] **联网/本地宠物切换**
  - GitHub 在线皮肤下载
  - 本地皮肤导入

- [ ] **数字灵魂架构 (HCDS)**
  - 混合记忆引擎（Vector + Graph）
  - 认知循环（PMRA Loop）
  - 睡眠反思机制
  - 动态人格演化

#### Medium Priority (P1)

- [ ] **悬浮窗聊天输入**
  - 双层渲染架构
  - 键盘弹出适配

- [ ] **屏幕强制干扰功能**
  - 愤怒模式：宠物变大遮挡屏幕
  - 强制休息提示

- [ ] **宠物情绪动画优化**
  - 根据应用包名改变表情
  - 更丰富的动画状态

#### Low Priority (P2)

- [ ] **社交功能**
  - 宠物排行榜
  - 好友互访

- [ ] **更多小游戏**
  - 单词猜谜（已有框架）
  - 记忆训练

---

## 📊 完成度统计

| 模块 | 完成度 | 说明 |
|------|--------|------|
| 核心功能 | 100% | 悬浮窗、监控、权限 |
| AI 系统 | 95% | 多模型、对话、记忆、降级 |
| 成长系统 | 100% | 等级、经验、奖惩、皮肤 |
| 互动系统 | 90% | 手势、睡眠、行为树 |
| UI 系统 | 95% | 聊天、日志、面板 |
| 开发工具 | 85% | 日志、调试、备份 |
| **总体完成度** | **约 92%** | - |

---

## 📚 相关文档

- 📖 [开发者指南](./DEVELOPMENT.md) - 快速上手开发
- 🏗️ [架构设计](./ARCHITECTURE.md) - 系统架构详解
- 🤖 [AI 使用指南](./AI_GUIDE.md) - AI 配置说明
- 🎮 [悬浮窗用户指南](./FLOAT_WINDOW_GUIDE.md) - 互动系统
- 📅 [更新日志](./UPDATES.md) - 版本历史
- 🐛 [Bug 追踪](./BUG.md) - 已知问题

---

**更新时间**: 2025-12-06  
**维护者**: WordParasite Team  
**License**: MIT
