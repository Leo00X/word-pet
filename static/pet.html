<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Lottie Player -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    <style>
        /* ÂÖ®Â±ÄÈáçÁΩÆ */
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: transparent;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', sans-serif;
            user-select: none;
            -webkit-user-select: none;
        }

        /* ÂÆπÂô® */
        .container {
            position: relative;
            width: 160px;
            height: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .container:active {
            transform: scale(0.95);
        }

        /* --- ÂØπËØùÊ∞îÊ≥°Ê†∑Âºè --- */
        .bubble {
            background: var(--bubble-bg, rgba(0, 0, 0, 0.85));
            color: var(--bubble-color, #00e676);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.4;
            max-width: 140px;
            text-align: center;
            margin-bottom: 10px;
            position: relative;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            pointer-events: none;
            border: 1px solid var(--bubble-border, #333);
        }

        .bubble.show {
            opacity: 1;
            transform: translateY(0);
        }

        .bubble::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px 6px 0;
            border-style: solid;
            border-color: var(--bubble-bg, rgba(0, 0, 0, 0.85)) transparent transparent transparent;
        }

        /* Ê∞îÊ≥°Ê†∑ÂºèÂèò‰Ωì */
        .bubble.cyberpunk {
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.9), rgba(255, 0, 255, 0.9));
            color: #fff;
            border: 1px solid #00ffff;
            text-shadow: 0 0 5px #00ffff;
        }

        .bubble.success {
            background: rgba(46, 213, 115, 0.9);
            color: #fff;
            border-color: #2ed573;
        }

        .bubble.warning {
            background: rgba(255, 71, 87, 0.9);
            color: #fff;
            border-color: #ff4757;
        }

        /* --- ÂÆ†Áâ©Âå∫Âüü --- */
        .pet-area {
            width: 100px;
            height: 100px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Lottie Âä®ÁîªÂÆπÂô® */
        #lottie-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Emoji ÂÆ†Áâ©ÔºàCSSÂä®ÁîªÊ®°ÂºèÔºâ */
        .pet-emoji {
            font-size: 70px;
            line-height: 1;
            z-index: 10;
            filter: drop-shadow(0 0 15px var(--glow-color, rgba(0, 217, 255, 0.4)));
            transition: all 0.3s ease;
        }

        /* --- CSS Âä®ÁîªÁ±ª --- */
        .anim-idle {
            animation: float 3s ease-in-out infinite;
        }

        .anim-happy {
            animation: bounce 0.5s ease infinite;
        }

        .anim-angry {
            animation: shake 0.3s ease infinite;
            filter: drop-shadow(0 0 20px rgba(255, 68, 68, 0.8)) !important;
        }

        .anim-study {
            animation: pulse 2s ease-in-out infinite;
            filter: drop-shadow(0 0 20px rgba(46, 213, 115, 0.6)) !important;
        }

        .anim-interact {
            animation: heartbeat 0.6s ease;
            filter: drop-shadow(0 0 25px rgba(255, 102, 204, 0.8)) !important;
        }

        /* --- ÂÖ≥ÈîÆÂ∏ßÂä®Áîª --- */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-12px);
            }
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0) scale(1);
            }

            50% {
                transform: translateY(-15px) scale(1.1);
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0) rotate(0deg);
            }

            25% {
                transform: translateX(-5px) rotate(-5deg);
            }

            75% {
                transform: translateX(5px) rotate(5deg);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.05);
                opacity: 0.9;
            }
        }

        @keyframes heartbeat {
            0% {
                transform: scale(1);
            }

            25% {
                transform: scale(1.2);
            }

            50% {
                transform: scale(1);
            }

            75% {
                transform: scale(1.15);
            }

            100% {
                transform: scale(1);
            }
        }

        /* --- ÂπΩÁÅµÁ∫ØCSSÊ®°ÂºèÔºàÂ§áÁî®Ôºâ--- */
        .ghost-css {
            width: 80px;
            height: 90px;
            background: var(--pet-color, #fff);
            border-radius: 40px 40px 0 0;
            position: relative;
            box-shadow: 0 0 15px var(--glow-color, rgba(255, 255, 255, 0.4));
        }

        .ghost-css.angry {
            background: #ff4444;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.6);
        }

        .ghost-footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 15px;
            display: flex;
        }

        .wave {
            flex: 1;
            background: inherit;
            border-radius: 0 0 10px 10px;
            margin: 0 -1px;
        }

        .eyes {
            position: absolute;
            top: 35px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        .eye {
            width: 12px;
            height: 12px;
            background: #2c3e50;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .blush {
            position: absolute;
            top: 50px;
            width: 10px;
            height: 6px;
            background: #ffaaab;
            border-radius: 50%;
            opacity: 0.6;
        }

        .blush.left {
            left: 12px;
        }

        .blush.right {
            right: 12px;
        }

        .mouth {
            position: absolute;
            top: 55px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-radius: 50%;
            background: #2c3e50;
            transition: all 0.2s;
        }

        /* ÊÑ§ÊÄíÁúºÁùõ */
        .ghost-css.angry .eye {
            height: 4px;
            transform: rotate(20deg);
        }

        .ghost-css.angry .eye:last-child {
            transform: rotate(-20deg);
        }

        .ghost-css.angry .mouth {
            width: 20px;
            height: 10px;
            border-radius: 10px 10px 0 0;
            background: transparent;
            border-top: 3px solid #000;
        }
    </style>
</head>

<body>

    <div class="container" id="petArea">
        <!-- ÂØπËØùÊ∞îÊ≥° -->
        <div class="bubble" id="bubble">WordParasite<br>Â∑≤ÂØÑÁîü...</div>

        <!-- ÂÆ†Áâ©Âå∫Âüü -->
        <div class="pet-area">
            <!-- Lottie Âä®ÁîªÂÆπÂô® -->
            <div id="lottie-container"></div>

            <!-- Emoji Ê®°Âºè -->
            <span class="pet-emoji anim-idle" id="petEmoji">üëª</span>

            <!-- CSS Ghost Ê®°ÂºèÔºàÂ§áÁî®Ôºâ -->
            <!-- <div class="ghost-css anim-idle" id="ghostCss">
                <div class="eyes">
                    <div class="eye left"></div>
                    <div class="eye right"></div>
                </div>
                <div class="blush left"></div>
                <div class="blush right"></div>
                <div class="mouth"></div>
                <div class="ghost-footer">
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                </div>
            </div> -->
        </div>
    </div>

    <script>
        // ========== ÂÖÉÁ¥†ÂºïÁî® ==========
        const petArea = document.getElementById('petArea');
        const bubble = document.getElementById('bubble');
        const petEmoji = document.getElementById('petEmoji');
        const lottieContainer = document.getElementById('lottie-container');

        // ========== Áä∂ÊÄÅÁÆ°ÁêÜ ==========
        let bubbleTimer = null;
        let currentState = 'idle';
        let currentSkin = null;
        let lottieAnimations = {}; // ÁºìÂ≠òÁöÑ Lottie Âä®ÁîªÂÆû‰æã
        let currentLottie = null;
        let renderMode = 'emoji'; // 'emoji' | 'lottie' | 'css'

        // ========== Ê∂àÊÅØÂ§ÑÁêÜ ==========

        /**
         * Êé•Êî∂ uni-app Ê∂àÊÅØ
         * @param {number} type - Ê∂àÊÅØÁ±ªÂûã
         * @param {string} msg - Ê∂àÊÅØÂÜÖÂÆπ
         */
        window.dataFromUniapp = function (type, msg) {
            console.log("[Pet] Êî∂Âà∞Ê∂àÊÅØ:", type, msg);

            try {
                // Â∞ùËØïËß£Êûê JSON
                let data = msg;
                if (typeof msg === 'string' && (msg.startsWith('{') || msg.startsWith('['))) {
                    data = JSON.parse(msg);
                }

                switch (type) {
                    case 0: // ÈöêËóèÊ∞îÊ≥°
                        hideBubble();
                        break;

                    case 1: // ÊôÆÈÄöÊ∂àÊÅØ + Ê≠£Â∏∏Áä∂ÊÄÅ
                        showBubble(typeof data === 'string' ? data : data.message);
                        changeState('idle');
                        break;

                    case 2: // ÊÑ§ÊÄíÊ∂àÊÅØ
                        showBubble(typeof data === 'string' ? data : data.message);
                        changeState('angry');
                        break;

                    case 3: // ÊÅ¢Â§çÊ≠£Â∏∏
                        changeState('idle');
                        break;

                    case 98: // Âä®ÁîªÁä∂ÊÄÅÂàáÊç¢
                        handleStateChange(data);
                        break;

                    case 99: // ÁöÆËÇ§ÂàáÊç¢
                        handleSkinChange(data);
                        break;

                    case 200: // [Êñ∞] Â§öÊ®°ÊÄÅ AI ÂìçÂ∫î
                        handleMultimodalResponse(data);
                        break;

                    default:
                        console.log("[Pet] Êú™Áü•Ê∂àÊÅØÁ±ªÂûã:", type);
                }
            } catch (err) {
                console.error("[Pet] Ê∂àÊÅØÂ§ÑÁêÜÈîôËØØ:", err);
            }
        };

        /**
         * Â§ÑÁêÜÂä®ÁîªÁä∂ÊÄÅÂàáÊç¢
         * @param {Object} data - { action, state, duration, shake, emoji }
         */
        function handleStateChange(data) {
            if (data.action !== 'change_state') return;

            const { state, duration, shake, emoji } = data;
            changeState(state, duration);

            // Â¶ÇÊûúÊúâ‰∏¥Êó∂ emoji Ë¶ÜÁõñ
            if (emoji && renderMode === 'emoji') {
                const originalEmoji = petEmoji.textContent;
                petEmoji.textContent = emoji;

                if (duration > 0) {
                    setTimeout(() => {
                        petEmoji.textContent = originalEmoji;
                    }, duration);
                }
            }
        }

        /**
         * Â§ÑÁêÜÁöÆËÇ§ÂàáÊç¢
         * @param {Object} data - { action, skinId, petType, animations, styles }
         */
        function handleSkinChange(data) {
            if (data.action !== 'change_skin') return;

            currentSkin = data;
            console.log("[Pet] ÂàáÊç¢ÁöÆËÇ§:", data.skinId);

            // Â∫îÁî®Ê†∑Âºè
            applyStyles(data.styles);

            // ÂàáÊç¢Ê∏≤ÊüìÊ®°Âºè
            if (data.animations && Object.keys(data.animations).some(k =>
                data.animations[k].endsWith('.json'))
            ) {
                // Lottie Ê®°Âºè
                switchToLottieMode(data.animations);
            } else {
                // Emoji/CSS Ê®°Âºè
                switchToEmojiMode(data.petType);
            }
        }

        /**
         * [Êñ∞] Â§ÑÁêÜÂ§öÊ®°ÊÄÅ AI ÂìçÂ∫î
         * @param {Object} data - { action, text, bubbleColor, duration, emotion }
         */
        function handleMultimodalResponse(data) {
            console.log("[Pet] Â§öÊ®°ÊÄÅÂìçÂ∫î:", data);

            const { action, text, bubbleColor, duration, emotion } = data;

            // 1. Êí≠ÊîæÂä®Áîª
            if (action && action !== 'idle') {
                // Êò†Â∞Ñ AI Âä®‰ΩúÂà∞Áé∞ÊúâÂä®ÁîªÁä∂ÊÄÅ
                const actionMap = {
                    'jump': 'happy',
                    'wave': 'happy',
                    'celebrate': 'happy',
                    'shake': 'angry',
                    'hide': 'idle',
                    'spin': 'happy',
                    'nod': 'idle',
                    'sleep': 'idle',
                    'scared': 'angry',
                    'shy': 'interact'
                };
                const animState = actionMap[action] || 'idle';
                changeState(animState, duration || 1500);
            }

            // 2. ÊòæÁ§∫Ê∞îÊ≥°
            if (text) {
                // Âä®ÊÄÅËÆæÁΩÆÊ∞îÊ≥°È¢úËâ≤
                if (bubbleColor) {
                    document.documentElement.style.setProperty('--bubble-bg', bubbleColor);
                }

                // Ê†πÊçÆÊÉÖÊÑüÈÄâÊã©Ê∞îÊ≥°Ê†∑Âºè
                let bubbleStyle = 'default';
                if (emotion === 'happy' || emotion === 'excited') {
                    bubbleStyle = 'success';
                } else if (emotion === 'angry') {
                    bubbleStyle = 'warning';
                }

                showBubble(text, bubbleStyle);
            }

            // 3. Ëß¶ËßâÂèçÈ¶àÔºàÂ¶ÇÊûúÊîØÊåÅÔºâ
            if (navigator.vibrate && (action === 'shake' || action === 'jump')) {
                navigator.vibrate(50);
            }
        }

        // ========== Ê∏≤ÊüìÊ®°ÂºèÂàáÊç¢ ==========

        /**
         * ÂàáÊç¢Âà∞ Lottie Âä®ÁîªÊ®°Âºè
         * @param {Object} animations - { idle: 'path.json', happy: 'path.json', ... }
         */
        function switchToLottieMode(animations) {
            renderMode = 'lottie';
            petEmoji.style.display = 'none';
            lottieContainer.style.display = 'block';

            // È¢ÑÂä†ËΩΩÊâÄÊúâÂä®Áîª
            Object.keys(animations).forEach(state => {
                if (animations[state].endsWith('.json')) {
                    loadLottieAnimation(state, animations[state]);
                }
            });

            // Êí≠Êîæ idle
            playLottieAnimation('idle');
        }

        /**
         * ÂàáÊç¢Âà∞ Emoji Ê®°Âºè
         * @param {string} petType - ÂÆ†Áâ©Á±ªÂûã
         */
        function switchToEmojiMode(petType) {
            renderMode = 'emoji';
            petEmoji.style.display = 'block';
            lottieContainer.style.display = 'none';

            // Ê†πÊçÆÁ±ªÂûãËÆæÁΩÆ emoji
            const emojiMap = {
                'ghost': 'üëª',
                'dog': 'üêï',
                'cockatiel': 'ü¶ú',
                'monk_parakeet': 'ü¶ú'
            };
            petEmoji.textContent = emojiMap[petType] || 'üëª';
        }

        /**
         * Âä†ËΩΩ Lottie Âä®Áîª
         * @param {string} name - Âä®ÁîªÂêçÁß∞
         * @param {string} path - Âä®Áîª JSON Ë∑ØÂæÑ
         */
        function loadLottieAnimation(name, path) {
            if (lottieAnimations[name]) return; // Â∑≤Âä†ËΩΩ

            try {
                lottieAnimations[name] = lottie.loadAnimation({
                    container: lottieContainer,
                    renderer: 'svg',
                    loop: name === 'idle' || name === 'study',
                    autoplay: false,
                    path: path,
                    name: name
                });
                console.log("[Pet] Lottie Âä†ËΩΩ:", name);
            } catch (err) {
                console.error("[Pet] Lottie Âä†ËΩΩÂ§±Ë¥•:", name, err);
            }
        }

        /**
         * Êí≠Êîæ Lottie Âä®Áîª
         * @param {string} name - Âä®ÁîªÂêçÁß∞
         */
        function playLottieAnimation(name) {
            if (currentLottie) {
                currentLottie.stop();
            }

            if (lottieAnimations[name]) {
                currentLottie = lottieAnimations[name];
                currentLottie.goToAndPlay(0);
            }
        }

        // ========== Áä∂ÊÄÅ‰∏éÊ†∑Âºè ==========

        /**
         * ÊîπÂèòÂä®ÁîªÁä∂ÊÄÅ
         * @param {string} state - Áä∂ÊÄÅÂêç
         * @param {number} duration - ÊåÅÁª≠Êó∂Èó¥Ôºà0Ë°®Á§∫Ê∞∏‰πÖÔºâ
         */
        function changeState(state, duration = 0) {
            currentState = state;

            if (renderMode === 'lottie' && lottieAnimations[state]) {
                playLottieAnimation(state);
            } else {
                // CSS Âä®ÁîªÊ®°Âºè
                petEmoji.className = 'pet-emoji anim-' + state;
            }

            // Ëá™Âä®ÊÅ¢Â§ç
            if (duration > 0 && state !== 'idle') {
                setTimeout(() => {
                    changeState('idle');
                }, duration);
            }
        }

        /**
         * Â∫îÁî®ÁöÆËÇ§Ê†∑Âºè
         * @param {Object} styles - Ê†∑ÂºèÈÖçÁΩÆ
         */
        function applyStyles(styles) {
            if (!styles) return;

            const root = document.documentElement;

            // ‰∏ªËâ≤Ë∞É
            if (styles.primaryColor) {
                root.style.setProperty('--glow-color', styles.primaryColor + '66');
                root.style.setProperty('--pet-color', styles.primaryColor);
            }

            // Ê∞îÊ≥°Ê†∑Âºè
            if (styles.bubble) {
                if (styles.bubble.background) {
                    root.style.setProperty('--bubble-bg', styles.bubble.background);
                }
                if (styles.bubble.textColor) {
                    root.style.setProperty('--bubble-color', styles.bubble.textColor);
                }
                if (styles.bubble.borderColor) {
                    root.style.setProperty('--bubble-border', styles.bubble.borderColor);
                }
            }

            // Ê∞îÊ≥°Ê†∑ÂºèÁ±ª
            if (styles.bubbleStyle && styles.bubbleStyle !== 'default') {
                bubble.classList.add(styles.bubbleStyle);
            }
        }

        // ========== Ê∞îÊ≥°ÂäüËÉΩ ==========

        function showBubble(text, style = 'default') {
            bubble.innerHTML = text;
            bubble.className = 'bubble show';
            if (style !== 'default') {
                bubble.classList.add(style);
            }

            if (bubbleTimer) clearTimeout(bubbleTimer);
            bubbleTimer = setTimeout(() => {
                hideBubble();
            }, 5000);
        }

        function hideBubble() {
            bubble.classList.remove('show');
        }

        // ========== ÊãñÊãΩÁ≥ªÁªü ==========

        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let dragThreshold = 10; // ÁßªÂä®Ë∂ÖËøá10pxÊâçÁÆóÊãñÊãΩ
        let hasMoved = false;

        // ÊãñÊãΩÂºÄÂßã
        function onDragStart(e) {
            const touch = e.touches ? e.touches[0] : e;
            dragStartX = touch.clientX;
            dragStartY = touch.clientY;
            hasMoved = false;

            // ÂêØÂä®ÈïøÊåâÊ£ÄÊµã
            longPressTimer = setTimeout(() => {
                if (!hasMoved) {
                    onLongPress();
                }
            }, 800);
        }

        // ÊãñÊãΩÁßªÂä®
        function onDragMove(e) {
            if (!dragStartX && !dragStartY) return;

            const touch = e.touches ? e.touches[0] : e;
            const deltaX = touch.clientX - dragStartX;
            const deltaY = touch.clientY - dragStartY;

            // Ê£ÄÊü•ÊòØÂê¶Ë∂ÖËøáÈòàÂÄº
            if (Math.abs(deltaX) > dragThreshold || Math.abs(deltaY) > dragThreshold) {
                hasMoved = true;
                isDragging = true;

                // ÂèñÊ∂àÈïøÊåâ
                if (longPressTimer) {
                    clearTimeout(longPressTimer);
                    longPressTimer = null;
                }

                // ÂèëÈÄÅÊãñÊãΩ‰∫ã‰ª∂Áªô uni-appÔºàËÆ©ÂéüÁîüÂ±ÇÂ§ÑÁêÜÁ™óÂè£ÁßªÂä®Ôºâ
                if (typeof uniapp !== 'undefined') {
                    uniapp.sendDataToUni(10, JSON.stringify({
                        event: 'drag_move',
                        deltaX: deltaX,
                        deltaY: deltaY
                    }));
                }
            }
        }

        // ÊãñÊãΩÁªìÊùü
        function onDragEnd(e) {
            // ÂèñÊ∂àÈïøÊåâÂÆöÊó∂Âô®
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }

            if (isDragging) {
                // ÊãñÊãΩÁªìÊùüÔºåÂèëÈÄÅÂê∏ÈôÑËØ∑Ê±Ç
                if (typeof uniapp !== 'undefined') {
                    uniapp.sendDataToUni(11, JSON.stringify({
                        event: 'drag_end',
                        timestamp: Date.now()
                    }));
                }
                isDragging = false;
            }

            dragStartX = 0;
            dragStartY = 0;
        }

        // ========== ‰∫§‰∫í‰∫ã‰ª∂ ==========

        let clickCount = 0;
        let clickTimer = null;
        let longPressTimer = null;

        // ÁÇπÂáªÂ§ÑÁêÜÔºàÂå∫ÂàÜÂçïÂáª/ÂèåÂáªÔºâ
        petArea.addEventListener('click', function (e) {
            // Â¶ÇÊûúÂàöÊãñÊãΩËøáÔºåÂøΩÁï•ÁÇπÂáª
            if (hasMoved) {
                hasMoved = false;
                return;
            }

            clickCount++;

            if (clickCount === 1) {
                // Á≠âÂæÖÁúãÊòØÂê¶ÊúâÁ¨¨‰∫åÊ¨°ÁÇπÂáª
                clickTimer = setTimeout(() => {
                    // ÂçïÂáª
                    onSingleClick();
                    clickCount = 0;
                }, 250);
            } else if (clickCount === 2) {
                // ÂèåÂáª
                clearTimeout(clickTimer);
                clickCount = 0;
                onDoubleClick();
            }
        });

        // ÂçïÂáª‰∫ã‰ª∂
        function onSingleClick() {
            // ÈÄöÁü• uni-app
            if (typeof uniapp !== 'undefined') {
                uniapp.sendDataToUni(1, JSON.stringify({
                    event: 'pet_clicked',
                    state: currentState,
                    timestamp: Date.now()
                }));
            }

            // Êú¨Âú∞ÂèçÈ¶àÔºöÊí≠Êîæ‰∫íÂä®Âä®Áîª
            changeState('interact', 1500);

            // Áú®ÁúºÊïàÊûúÔºàÂ¶ÇÊûúÊòØ CSS Ê®°ÂºèÔºâ
            if (renderMode === 'css') {
                const eyes = document.querySelectorAll('.eye');
                eyes.forEach(e => e.style.height = '2px');
                setTimeout(() => {
                    eyes.forEach(e => e.style.height = '12px');
                }, 200);
            }
        }

        // ÂèåÂáª‰∫ã‰ª∂ - ÊòæÁ§∫Âø´Êç∑ËèúÂçï
        function onDoubleClick() {
            if (typeof uniapp !== 'undefined') {
                uniapp.sendDataToUni(4, JSON.stringify({
                    event: 'double_click',
                    timestamp: Date.now()
                }));
            }

            // ÊòæÁ§∫"ÊâìÂºÄ‰∏ªÁïåÈù¢"ÊèêÁ§∫
            showBubble('üí¨ ÂèåÂáªÊâìÂºÄApp', 'success');
        }

        // ÈïøÊåâ‰∫ã‰ª∂
        function onLongPress() {
            if (typeof uniapp !== 'undefined') {
                uniapp.sendDataToUni(3, JSON.stringify({
                    event: 'long_press',
                    duration: 800
                }));
            }

            // ÊòæÁ§∫ÈÄâÈ°πÊèêÁ§∫
            showBubble('üìã ÈïøÊåâËèúÂçï');
        }

        // Ëß¶Êë∏‰∫ã‰ª∂ÁªëÂÆö
        petArea.addEventListener('touchstart', onDragStart, { passive: true });
        petArea.addEventListener('touchmove', onDragMove, { passive: true });
        petArea.addEventListener('touchend', onDragEnd);
        petArea.addEventListener('touchcancel', onDragEnd);

        // Èº†Ê†á‰∫ã‰ª∂ÔºàH5Ë∞ÉËØïÁî®Ôºâ
        petArea.addEventListener('mousedown', onDragStart);
        document.addEventListener('mousemove', onDragMove);
        document.addEventListener('mouseup', onDragEnd);

        // ========== Âø´Êç∑Êìç‰Ωú ==========

        // Êëá‰∏ÄÊëáÊ£ÄÊµãÔºàÊâãÊú∫ÊôÉÂä®Ôºâ
        if (window.DeviceMotionEvent) {
            let lastShakeTime = 0;
            const shakeThreshold = 25;  // ÊèêÈ´òÈòàÂÄºÔºåÈÅøÂÖçËØØËß¶ÔºàÂéü15Ôºâ

            window.addEventListener('devicemotion', function (e) {
                const acc = e.accelerationIncludingGravity;
                if (!acc) return;

                const total = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);

                if (total > shakeThreshold) {
                    const now = Date.now();
                    // Âª∂ÈïøÂÜ∑Âç¥Êó∂Èó¥Âà∞3ÁßíÔºåÈÅøÂÖçËøûÁª≠Ëß¶ÂèëÔºàÂéü1000Ôºâ
                    if (now - lastShakeTime > 3000) {
                        lastShakeTime = now;
                        onShake();
                    }
                }
            });
        }

        function onShake() {
            if (typeof uniapp !== 'undefined') {
                uniapp.sendDataToUni(5, JSON.stringify({
                    event: 'shake',
                    timestamp: Date.now()
                }));
            }

            // ÊëáÊôÉÂèçÈ¶à
            changeState('happy', 2000);
            showBubble('üéâ Êëá‰∏ÄÊëáÔºÅ');
        }

        // ========== ÂàùÂßãÂåñ ==========

        console.log('[Pet] ÊÇ¨ÊµÆÁ™óÂàùÂßãÂåñÂÆåÊàê');

        setTimeout(() => {
            showBubble("WordParasite<br>Â∑≤ÂØÑÁîü...");
        }, 800);

    </script>
</body>

</html>