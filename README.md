👾 WordParasite (单词寄生兽) | Desktop AI Companion

> **📅 最新更新**: 2025-12-08 - 🎉 Live2D 部位联动交互 + 开发调试模式
> 📖 功能指南: [悬浮窗用户指南](./docs/guides/FLOAT_WINDOW_GUIDE.md) | [更新日志](./docs/maintenance/UPDATES.md) | [AI使用指南](./docs/guides/AI_GUIDE.md)  
> 🛡️ **开发者必读**: [BUG防范指南](./docs/maintenance/bug_prevention_guide.md) - 18个易错案例 + 三轮审查方法

---

## 📚 文档导航

### 用户文档
- 📖 [用户指南](./README.md) - 本文档，项目介绍和使用指南
- 🎮 [悬浮窗使用指南](./docs/guides/FLOAT_WINDOW_GUIDE.md) - 智能交互系统说明
- 🤖 [AI 系统配置](./docs/guides/AI_GUIDE.md) - 多模型配置教程
- 🎨 [Live2D 路线图](./docs/guides/LIVE2D_ROADMAP.md) - 功能规划与未来愿景 🆕

### 开发文档
- 🚀 **[开发者指南](./DEVELOPMENT.md)** - 快速上手开发 ⭐ NEW
- 🏗️ **[架构设计](./ARCHITECTURE.md)** - 系统架构详解 ⭐ NEW
- ✨ **[功能清单](./FEATURES.md)** - 完整功能说明 ⭐ NEW

### 维护文档
- 📅 [更新日志](./docs/maintenance/UPDATES.md) - 功能更新记录
- 🐛 [Bug 追踪](./docs/maintenance/BUG.md) - 已知问题和修复进度
- 🛡️ [Bug 防范指南](./docs/maintenance/bug_prevention_guide.md) - 开发规范与最佳实践

---

"It watches you. It judges you. It forces you to learn."

一个基于 Android 原生能力的桌面 AI 伴侣。它不是单词书，它是住在你手机桌面上、在你摸鱼时“重拳出击”的毒舌监督者与陪伴。

📖 项目背景与定位 (Concept)

💡 **核心理念：从“内容提供”转向“行为监督”**

市面上已经有足够优秀的背单词 App（如“词根单词”、“墨墨”）。WordParasite 不重复造轮子去维护海量词库，而是定位为 **“学习伴侣/监督者” (Study Companion/Tracker)**。

* **它的角色**：不教你背单词，但逼你去背单词。
* **它的形态**：一只寄生在手机桌面的像素宠物，拥有 Gemini AI 赋予的“毒舌”人格。

---

📱 App 界面与功能指南 (User Guide)

本项目采用 **赛博朋克/复古像素 (Cyberpunk/Pixel)** 设计风格，将手机视为“宿主”，App 为“控制终端”。

### 1. 主控台 (Main Dashboard)
进入 App 首页，您将看到模拟掌机的操作界面：
* **状态监视屏**：
    * **宠物投影**：显示当前寄生兽的形象（悬浮/静止）。
    * **HP (心情)**：根据您的行为变化。摸鱼扣血，学习回血。
    * **XP (经验)**：积累学习时长升级。
    * **实时交互**：点击屏幕中的宠物，它会随机弹出气泡对话。

### 2. 状态监控 (Status Tab)
点击下方 **“状态监控”** 切换卡片：
* **系统连接指示灯**：
    * `悬浮窗`：检测悬浮权限状态（🟢正常 / 🔴断开）。
    * `监控权`：检测 UsageStats 权限状态。
* **核心操作键**：
    * **🟢 召唤寄生兽 (SUMMON)**：在桌面生成悬浮窗。
    * **🔴 收回寄生兽 (RECALL)**：关闭悬浮窗。
    * **👁 开启全域监控 (START MONITOR)**：启动后台轮询服务，开始记录应用使用情况。
* **📝 成长日记 (Growth Log)**：
    * 实时显示最近 3 条行为记录（如“投喂成功”、“误食毒药”）。
    * 点击 **“查看全部档案”** 可进入历史记录页，查看所有过往数据（支持本地持久化存储）。

### 3. 系统设置 (Config Tab)
点击下方 **“系统设置”** 切换卡片：
* **🍖 投喂规则 (Whitelist / 白名单)**：
    * 点击进入 **应用选择器**。
    * 勾选您的学习软件（如：墨墨背单词、多邻国）。
    * **效果**：使用这些软件时，宠物心情增加，经验增加。
* **☠️ 禁忌物品 (Blacklist / 黑名单)**：
    * 点击进入 **应用选择器**。
    * 勾选您的娱乐软件（如：抖音、王者荣耀）。
    * **效果**：使用这些软件时，宠物心情大减，触发毒舌警告或红色暴怒模式。
* **⚡ 扫描频率 (Power Saving)**：
    * **极速 (3s)**：反应最快，但耗电。
    * **省电 (60s)**：仅用于统计时长，适合后台挂机。
* **🖥️ 监控终端 (Terminal)**：
    * 点击打开黑客风格的 **日志控制台**，查看底层 Native.js 的实时扫描日志与报错信息。

---

🌟 核心功能 (Key Features)

1. **👻 真·桌面悬浮宠物 (Global Floating Window)**
    * 利用 Android 系统级悬浮窗权限，让宠物始终“寄生”在屏幕边缘。
    * **情绪反馈**：
        * **开心模式**：检测到白名单应用（背单词），宠物发送鼓励气泡（“好耶！是精神食粮！”）。
        * **暴怒模式**：检测到黑名单应用（摸鱼），宠物变身并发送警告（“你在干什么？！快去背单词！💢”）。

2. **👁️ 上帝之眼：无感监控 (Usage Stats Monitor)**
    * **技术原理**：通过 Native.js 调用 Android `UsageStatsManager`，毫秒级轮询当前前台应用包名。
    * **智能判别**：自动识别用户是在“学习”还是“摸鱼”，并根据黑白名单配置进行奖惩。

3. **🧠 AI 注入灵魂 (Gemini Persona)** [WIP]
    * 接入 Google Gemini API，让宠物拥有记忆。
    * **Prompt 设定**："你是一只傲娇的电子猫。看到用户今天刷了2小时抖音只背了5分钟单词。请生成一句50字以内的毒舌嘲讽。"
    * **✨ Phase 3 升级**: 记忆增强 Prompt + 4级降级策略 + 对话历史上下文”

4. **⚡ 本地化存储与缓存**
    * **应用列表缓存**：首次扫描后自动缓存已安装应用列表，实现“秒开”选择页。
    * **数据持久化**：心情值、经验值、历史日记均写入本地 Storage，杀后台不丢失。

5. **🎮 悬浮窗智能互动系统** [NEW]
    * **行为树状态管理**: 5种根状态 + 12种细分子状态 (IDLE/INTERACTION/WORKING/ANGRY/SLEEPING)
    * **手势识别引擎**: 支持TAP/DOUBLE_TAP/LONG_PRESS/SWIPE/THROW，带防抖和模式检测
    * **睡眠/唤醒机制**: 深夜自动入睡，做梦系统，睡眠恢复心情
    * **状态持续时间追踪**: 记录每个状态的持续时间，提供每日统计
    * **AI降级策略**: 4级降级 (完整AI→压缩AI→本地模板→静态响应)，确保离线可用
    * **📂 技术架构**: 7个模块化 Composable，所有文件 <350行，符合防臃肿协议

---

🛠️ 技术架构 (Tech Stack)

* **IDE**: HBuilderX (强依赖 AST 语法提示)
* **框架**: uni-app (Vue3) + UTS
* **核心插件**:
    * `android-floatwindow` (UTS): 处理悬浮窗与 WebView 通信。
    * Native.js: 处理 Android 原生权限申请、应用列表扫描、前台应用监控。

📂 目录结构 | Project Structure

```text
word-pet/
├── pages/
│   ├── index/              # 主控台模块
│   │   ├── components/     # UI 组件 (22个)
│   │   ├── composables/    # 业务逻辑 (26个)
│   │   └── index.vue       # 页面入口
│   └── config/             # 配置页面
├── static/
│   └── pet.html            # 悬浮窗 WebView
├── utils/                  # 全局工具库
│   ├── aiService.js        # AI 服务
│   ├── aiAdapters.js       # AI 适配器
│   └── encryptStorage.js   # 加密存储
├── uni_modules/
│   └── android-floatwindow/  # UTS 插件
└── manifest.json           # 应用配置
```

> 💡 完整目录结构请查看 [开发者指南](./DEVELOPMENT.md#项目结构)

🚀 快速开始 | Getting Started

⚠️ **注意：本项目必须制作自定义调试基座才能运行。**

1.  **环境准备**

      * 下载 HBuilderX。
      * 准备 Android 手机（开启开发者模式）。

2.  **插件配置**

      * 在 `manifest.json` 中获取 DCloud AppID。
      * 去插件市场绑定 `android-floatwindow` 试用。

3.  **运行项目**

      * 连接手机。
      * 菜单栏：运行 -\> 运行到手机 -\> **制作自定义调试基座**。
      * 基座制作完成后，选择 **“自定义调试基座”** 运行。



✅ 开发进度 | Roadmap

[x] 基础设施搭建 (Vue3 + Native.js)
[x] 核心能力实现 (悬浮窗 + 应用统计权限)
[x] 界面重构 (赛博朋克像素风 UI)
[x] 黑白名单系统 (应用扫描 + 本地存储)
[x] 成长日记 (数据持久化 + 历史回顾)
[x] AI 多模型系统 (DeepSeek + Gemini 2.5 Flash/Pro + 自定义模型)
[x] 多轮对话与上下文记忆 (跨模型切换保留历史)
[x] 聊天历史分页加载 (默认显示3条，按需加载)
[x] **聊天对话系统** (ChatPanel + 快捷回复 + Markdown渲染) ✅ NEW
[x] **宠物成长系统** (等级/经验/心情/饥饿/亲密) ✅ NEW
[x] **成就系统** (13种成就 + 自动解锁 + 奖励发放) ✅ NEW
[x] **宠物形态系统** (4种宠物 × 3阶段进化) ✅ NEW
[x] **学习奖励/摸鱼惩罚** (实时时长统计) ✅ NEW
[x] **每日问候系统** (分时段问候 + 悬浮窗同步) ✅ NEW
[x] **抚摸互动** (点击宠物增加心情和亲密度) ✅ NEW
[x] **皮肤系统** (内置皮肤 + 商城购买 + 皮肤管理) ✅ 2025-12-06
[x] **皮肤切换与同步** (悬浮窗实时同步 + 本地持久化) ✅ 2025-12-06
[x] **开发者测试功能** (快速升级 + 增加金币) ✅ 2025-12-06
[x] **联网/本地宠物切换**（github、本地）（在线皮肤下载）
[x] **AI 自动降级系统** (超时自动切换模型 + 模型轮询) ✅ 2025-12-07
[x] **数字灵魂架构 (HCDS)** - 混合记忆引擎 ✅ 2025-12-07
[x] **悬浮窗分层宠物模式** (图片实体 + 部位交互) ✅ 2025-12-07
[x] **热区 AI 混合响应** (本地/云端策略 + 心情影响) ✅ 2025-12-08
[x] **Live2D 系统集成** (Cubism 2/4 + 本地加载 + 情感交互) ✅ 2025-12-08
[x] **Live2D 部位联动** (坐标区域检测 + 参数动画 + 不同部位反应) ✅ 2025-12-08
[x] **开发调试模式** (悬浮窗 HTML 热更新 + 本地 HTTP 服务器) ✅ 2025-12-08

#### Medium Priority (P1)

- [ ] **悬浮窗聊天输入**
  - 双层渲染架构
  - 键盘弹出适配

- [ ] **悬浮窗情绪动画优化**
  - 根据应用包名改变表情
  - 更丰富的动画状态

- [ ] **屏幕强制干扰功能**
  - 愤怒模式：宠物变大遮挡屏幕
  - 强制休息提示


---

## 📄 License

MIT License.

Created by WordParasite Team with HBuilderX & uni-app.



