# 已知问题 (Known Issues)

> **文档定位**: 追踪未修复的 Bug  
> **已修复**: 详细记录请查阅 [UPDATES.md](./UPDATES.md)  
> **测试清单**: [TESTING_CHECKLIST.md](./TESTING_CHECKLIST.md)


---

## 📝 Bug 报告模板

复制以下模板来报告新 Bug：

```markdown
### #xxx 【模块名】简短描述
**发现时间**: YYYY-MM-DD  
**严重程度**: 🔴/🟡/🟢  
**状态**: 未修复  

**问题描述**:  
详细描述问题现象

**期望行为**:  
正确的表现应该是什么

**复现步骤**:
1. 打开xxx
2. 点击xxx
3. 观察到xxx

**可能原因**:  
初步分析

**相关文件**:
- 文件路径1
- 文件路径2
```

---

## 📊 快速概览

| 优先级 | 未修复 | 修复中 | 已修复待测试 |
|--------|--------|--------|--------------|
| 🔴 高 | 0 | 1 | 4 |
| 🟡 中 | 1 | 0 | 0 |
| 🟢 低 | 3 | 0 | 0 |

**总计**: 9 个活跃问题

---

## 🔍 快速导航

- [🔴 高优先级](#-高优先级影响核心功能) - #101, #102, #103, #104, #105
- [🟡 中优先级](#-中优先级影响用户体验) - #106
- [🟢 低优先级](#-低优先级轻微问题) - #1, #2, #3, #8

---

## 🔴 高优先级（影响核心功能）

### #101 【悬浮窗】点击宠物没有AI响应气泡
**发现时间**: 2025-12-06  
**状态**: ✅ 已修复，待测试  
**测试设备**: Android真机

**问题描述**:  
点击悬浮窗宠物后，只有跳跃动画，没有显示 AI 生成的文本气泡。

**根本原因**:  
🔥 **功能不闭环**：`usePetInteraction.js` 已创建但从未在 `index.vue` 中导入和集成！

**修复方案**:  
在 index.vue 中集成 `usePetInteraction` 并连接回调链路。

**相关文件**:
- `pages/index/index.vue`
- `pages/index/composables/usePetInteraction.js`
- `pages/index/composables/useFloatWindow.js`

---

### #102 【悬浮窗】长按显示系统菜单而非自定义气泡
**发现时间**: 2025-12-06  
**状态**: ✅ 已修复，待测试  
**测试设备**: Android真机

**问题描述**:  
长按宠物时，显示的是系统默认菜单，而不是预期的自定义气泡。

**根本原因**:  
1. touchstart 使用 `passive: true` 导致无法 `preventDefault()`
2. 未阻止 `contextmenu` 事件

**修复方案**:  
修改 `passive: false` 并添加 contextmenu 事件监听器。

**相关文件**:
- `static/pet.html`

---

### #103 【悬浮窗】拖拽到边缘无吸附效果
**发现时间**: 2025-12-06  
**状态**: 🔧 修复中，再次测试  
**测试设备**: Android真机

**问题描述**:  
拖拽悬浮窗到屏幕边缘时，没有出现预期的吸附（磁吸）效果。

**修复方案**:  
改为 `setSidePattern(3)`（四边吸附）。

**相关文件**:
- `pages/index/composables/useFloatWindow.js`

---

### #104 【悬浮窗】空白尺寸
**发现时间**: 2025-12-06  
**状态**: ✅ 已修复，待测试  
**测试设备**: Android真机

**问题描述**:  
悬浮窗尺寸不正确，导致很多空白区域。

**根本原因**:  
- `FLOAT_SIZES.NORMAL` 设为 200x200（太大）
- 气泡占用固定空间，即使隐藏

**修复方案**:  
1. 减小 `NORMAL` 尺寸为 100x100
2. 气泡使用 `position: absolute` 悬浮在宠物上方

**相关文件**:
- `pages/index/composables/useFloatWindow.js`
- `static/pet.html`

---

### #105 【悬浮窗】气泡被截断无法显示
**发现时间**: 2025-12-06  
**状态**: ✅ 已修复，待测试  
**测试设备**: Android真机

**问题描述**:  
悬浮窗尺寸改为 100x100 后，气泡无法显示（被悬浮窗边界截断）。

**修复方案**:  
显示气泡时自动扩大悬浮窗，气泡消失后恢复小尺寸。

**相关文件**:
- `static/pet.html`
- `pages/index/composables/useFloatWindow.js`

---

## 🟡 中优先级（影响用户体验）

### #106 重新编译后，【召唤寄生兽】按键点会报错
**发现时间**: 2025-12-06  
**状态**: 🔧 未修复  
**测试设备**: Android真机

**问题描述**:  
重新编译后，之前【召唤寄生兽】的宠物会仍然存在，但是重新点击【召唤寄生兽】会报错。同时新编译的内容可能不会更新。

**期望行为**:  
【召唤寄生兽】按键点不会报错。

---

## 🟢 低优先级（轻微问题）

### #1 每日问候在悬浮窗启动后没有显示
**发现时间**: 2025-12-05  
**状态**: ✅ 已修复，待测试

**问题描述**:  
用户首次打开应用时，如果悬浮窗尚未开启，每日问候只会添加到聊天记录中。开启悬浮窗时，问候与初始化消息冲突导致快速闪过。

**修复方案**:  
移除 pet.html 中的自动初始化消息，由 index.vue 统一控制。

**相关文件**:
- `static/pet.html`
- `pages/index/index.vue`

---

### #2 聊天心情值不同步
**发现时间**: 2025-12-05  
**状态**: 未修复

**问题描述**:  
【对话】窗口，AI发来心情值减少的消息，但是宠物的状态栏里心情值没有变化。

---

### #3 皮肤管理窗口无法滚动
**发现时间**: 2025-12-05  
**状态**: 未修复

**问题描述**: 
皮肤管理 & 皮肤商城窗口大小不适应，无法往下滚动。

**相关文件**: `pages/skin/`

---

### #8 "摇一摇"互动乱触发
**发现时间**: 2025-12-05  
**状态**: 未修复

**问题描述**: 
摇一摇功能过于敏感，容易误触发。

**建议**: 提高触发阈值或增加防抖

**相关文件**: 
- `static/pet.html` (摇一摇检测逻辑)

---

## 📋 修复优先级

### 本周重点
1. **#101, #102** - 悬浮窗 AI 响应（已修复，待真机测试）
2. **#103** - 边缘吸附（测试中）

### 下一阶段
1. **#106** - 重新编译报错
2. **#2, #3, #8** - 体验优化

---

**更新时间**: 2025-12-06  
**总数**: 9 个活跃问题（4个已修复待测试，1个修复中，4个未修复）
